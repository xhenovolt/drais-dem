"use client";
import React,{useState} from 'react';
import useSWR from 'swr';
import { t } from '@/lib/i18n';
const API_BASE=process.env.NEXT_PUBLIC_PHP_API_BASE||'http://localhost/drais/api';
const fetcher=(u:string)=>fetch(u).then(r=>r.json());
export const SettingsManager: React.FC=()=>{
  const {data,mutate}=useSWR(`${API_BASE}/school_settings.php`,fetcher); const rows=data?.data||[];
  const [form,setForm]=useState({ key_name:'', value_text:'' });
  const add=async()=>{ if(!form.key_name) return; await fetch(`${API_BASE}/school_settings.php`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(form)}); setForm({ key_name:'', value_text:''}); mutate(); };
  return <div className="space-y-4"> <h2 className="font-semibold text-sm">{t('general.settings','Settings')}</h2>
    <div className="grid md:grid-cols-4 gap-2 text-xs"> <input placeholder={t('general.key','Key')} value={form.key_name} onChange={e=>setForm({...form,key_name:e.target.value})} className="px-2 py-1 rounded border" /> <input placeholder={t('general.value','Value')} value={form.value_text} onChange={e=>setForm({...form,value_text:e.target.value})} className="px-2 py-1 rounded border md:col-span-2" /> <button onClick={add} disabled={!form.key_name} className="px-2 py-1 rounded bg-[var(--color-primary)] text-white disabled:opacity-40">{t('common.save','Save')}</button> </div>
    <div className="rounded border divide-y bg-white/40 dark:bg-slate-800/40 text-xs"> {rows.map((r:any)=>(<div key={r.id} className="grid md:grid-cols-3 gap-2 px-3 py-2"><span className="truncate">{r.key_name}</span><span className="col-span-1 truncate">{r.value_text}</span><span className="text-[10px]">{r.id}</span></div>))} {rows.length===0 && <div className="px-3 py-6 text-center text-gray-400">{t('general.no_settings','No settings')}</div>} </div>
  </div>;
};